# 2. 프로그램이 실행 되었지만, 뭐가 뭔지 하나도 모르겠다.

## 2.1 운영체제, 프로세스, 스레드의 근본 이해하기

### **1️⃣ CPU와 프로그램 실행**

- CPU는 매우 단순: **명령어를 Fetch → Decode → Execute → Update PC** 반복
- Program Counter(PC) 레지스터가 현재 실행할 명령어 위치를 가리킴
- 여러 프로그램을 동시에 돌리는 것처럼 보이게 하는 것은 **운영체제 스케줄러** 덕분

### **2️⃣ 운영체제(OS)의 역할**

- 하드웨어 위에서 **프로그램 실행 환경을 관리**
- 주요 기능:
  - 프로세스 관리 (멀티태스킹, 스케줄링, PCB 관리)
  - 메모리 관리 (주소 공간 분리, 가상/물리 메모리 매핑)
  - 파일 시스템 관리
  - I/O 장치 관리
  - 보호 및 보안

### **3️⃣ 프로세스**

- **실행 중인 프로그램 + 상태 + 자원** 묶음
- 메모리 구조:
  - 코드 영역 (Text) → 프로그램 명령어
  - 데이터 영역 (Data) → 전역/정적 변수
  - 힙 영역 (Heap) → 동적 메모리
  - 스택 영역 (Stack) → 함수 호출, 지역 변수, 리턴 주소
- 컨텍스트(Context, PCB)에 실행 상태 저장 → 컨텍스트 스위칭으로 멀티태스킹 구현

### **4️⃣ 스레드**

- **프로세스 안에서 실행 흐름 단위**
- 메모리 공유: 코드, 데이터, 힙
- 독립 스택: 각 스레드가 함수 호출/지역 변수 사용
- 장점: 오버헤드 적고, 통신이 용이
- 단점: 동기화 문제 발생 가능

### **5️⃣ 스레드풀(Thread Pool)**

- 미리 생성된 스레드 풀에서 작업 할당 → 스레드 재사용
- 장점:
  - 스레드 생성 비용 절감
  - 시스템 자원 효율적 관리
  - 빠른 작업 응답
- 스레드풀 크기 결정:
  - CPU 바운드 작업 → 스레드 수 ≈ CPU 코어 수
  - I/O 바운드 작업 → 스레드 수 > CPU 코어 수 (대기 시간 고려)

## 2.2 스레드 간 공유되는 프로세스 리소스

# 2.2 스레드 간 공유되는 프로세스 리소스

### **1️⃣ 스레드의 메모리 구조**

| 영역        | 공유여부 | 설명                                              |
| ----------- | -------- | ------------------------------------------------- |
| 코드 영역   | 공유     | 모든 스레드가 같은 명령어 집합 실행               |
| 데이터 영역 | 공유     | 전역 변수, static 변수, 모든 스레드 접근 가능     |
| 힙 영역     | 공유     | 동적 메모리(malloc/new) 모든 스레드 접근 가능     |
| 스택 영역   | 독립     | 각 스레드 별 함수 호출, 지역 변수, 리턴 주소 저장 |

### **2️⃣ 동적 라이브러리(DLL/SO)와 스레드**

- 코드 영역: 여러 프로세스/스레드가 **공유 가능한 읽기 전용 메모리**
- 데이터 영역: 구현에 따라 **프로세스별 별도 공간** 할당 가능
- 장점: 여러 프로세스가 동일 코드 공유, 메모리 낭비 감소

### **3️⃣ 스레드 전용(thread-local) 데이터**

- 스레드마다 **독립적인 전역/정적 변수** 필요 시 사용
- C++ 예: thread_local int counter; 또는 GCC/Clang 확장 \_\_thread
- 저장 위치: 스택과 별도로 런타임/OS가 관리하는 스레드 전용 영역
- 특징: 다른 스레드와 공유하지 않고, 스레드 종료 시 자동 해제
